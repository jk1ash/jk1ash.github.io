<!doctype html><html lang=en-us dir=ltr><head><meta charset=utf-8><meta name=viewport content='width=device-width,initial-scale=1'><meta name=description content="æ±‡æ€»k8så­¦ä¹ è¿‡ç¨‹ä¸­çš„ç¬”è®°\n"><title>Kuberneteså­¦ä¹ ç¬”è®°</title>
<link rel=canonical href=https://blog.jklash.com/p/kubernetes%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/><link rel=stylesheet href=/scss/style.min.663803bebe609202d5b39d848f2d7c2dc8b598a2d879efa079fa88893d29c49c.css><meta property='og:title' content="Kuberneteså­¦ä¹ ç¬”è®°"><meta property='og:description' content="æ±‡æ€»k8så­¦ä¹ è¿‡ç¨‹ä¸­çš„ç¬”è®°\n"><meta property='og:url' content='https://blog.jklash.com/p/kubernetes%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/'><meta property='og:site_name' content='æœˆèƒ§æ˜'><meta property='og:type' content='article'><meta property='article:section' content='Post'><meta property='article:tag' content='Linux'><meta property='article:published_time' content='2023-01-01T00:00:00+00:00'><meta property='article:modified_time' content='2023-01-01T00:00:00+00:00'><meta name=twitter:title content="Kuberneteså­¦ä¹ ç¬”è®°"><meta name=twitter:description content="æ±‡æ€»k8så­¦ä¹ è¿‡ç¨‹ä¸­çš„ç¬”è®°\n"><link rel="shortcut icon" href=/favicon.svg></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label=åˆ‡æ¢èœå•>
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/img/avatar_hu4410300129322454102.png width=300 height=301 class=site-logo loading=lazy alt=Avatar>
</a><span class=emoji>ğŸŒ™</span></figure><div class=site-meta><h1 class=site-name><a href=/>æœˆèƒ§æ˜</a></h1><h2 class=site-description>æœˆæ˜æ˜Ÿç¨€ï¼Œä¹Œé¹Šå—é£</h2></div></header><ol class=menu-social><li><a href=https://github.com/jk1ash target=_blank title=GitHub rel=me><svg class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg></a></li></ol><ol class=menu id=main-menu><li><a href=/archives/><svg class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg>
<span>Archives</span></a></li><li><a href=/search/><svg class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg>
<span>Search</span></a></li><li><a href=/links/><svg class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M10 14a3.5 3.5.0 005 0l4-4a3.5 3.5.0 00-5-5l-.5.5"/><path d="M14 10a3.5 3.5.0 00-5 0l-4 4a3.5 3.5.0 005 5l.5-.5"/></svg>
<span>Links</span></a></li><li class=menu-bottom-section><ol class=menu><li id=dark-mode-toggle><svg class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<svg class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<span>æš—è‰²æ¨¡å¼</span></li></ol></li></ol></aside><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">ç›®å½•</h2><div class=widget--toc><nav id=TableOfContents><ol><li><a href=#åŸºæœ¬æ¦‚å¿µ>åŸºæœ¬æ¦‚å¿µ</a><ol><li><a href=#åè¯è§£é‡Š>åè¯è§£é‡Š</a></li><li><a href=#ç½‘ç»œæ¨¡å‹>ç½‘ç»œæ¨¡å‹</a></li></ol></li><li><a href=#k8sæ¶æ„>k8sæ¶æ„</a><ol><li><a href=#master>master</a></li><li><a href=#node>node</a></li></ol></li><li><a href=#å®‰è£…>å®‰è£…</a><ol><li><a href=#å…³é—­swap>å…³é—­swap</a></li><li><a href=#å®‰è£…kubeadm-kubeadm-kubectlå›½å†…æº>å®‰è£…kubeadm kubeadm kubectlï¼ˆå›½å†…æºï¼‰</a></li><li><a href=#ä¸‹è½½k8sé•œåƒå›½å†…æº>ä¸‹è½½k8sé•œåƒï¼ˆå›½å†…æºï¼‰</a></li></ol></li><li><a href=#éƒ¨ç½²>éƒ¨ç½²</a><ol><li><a href=#åˆå§‹åŒ–master>åˆå§‹åŒ–Master</a></li><li><a href=#é…ç½®kubectl>é…ç½®kubectl</a><ol><li><a href=#kubectlå¸¸ç”¨å‘½ä»¤>kubectlå¸¸ç”¨å‘½ä»¤</a></li></ol></li><li><a href=#éƒ¨ç½²flannel>éƒ¨ç½²flannel</a></li><li><a href=#å­èŠ‚ç‚¹åŠ å…¥master>å­èŠ‚ç‚¹åŠ å…¥Master</a></li><li><a href=#åˆ é™¤èŠ‚ç‚¹>åˆ é™¤èŠ‚ç‚¹</a></li></ol></li><li><a href=#è¿è¡Œåº”ç”¨>è¿è¡Œåº”ç”¨</a><ol><li><a href=#å‘½ä»¤è¿è¡Œ>å‘½ä»¤è¿è¡Œ</a></li><li><a href=#é…ç½®è¿è¡Œ>é…ç½®è¿è¡Œ</a></li></ol></li></ol></nav></div></section></aside><main class="main full-width"><article class=main-article><header class=article-header><div class=article-details><header class=article-category><a href=/categories/2023/>2023</a></header><div class=article-title-wrapper><h2 class=article-title><a href=/p/kubernetes%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/>Kuberneteså­¦ä¹ ç¬”è®°</a></h2></div><footer class=article-time><div><svg class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published>Jan 01, 2023</time></div><div><svg class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>é˜…è¯»æ—¶é•¿: 5 åˆ†é’Ÿ</time></div></footer></div></header><section class=article-content><p>æ±‡æ€»k8så­¦ä¹ è¿‡ç¨‹ä¸­çš„ç¬”è®°</p><h2 id=åŸºæœ¬æ¦‚å¿µ>åŸºæœ¬æ¦‚å¿µ</h2><h3 id=åè¯è§£é‡Š>åè¯è§£é‡Š</h3><p><strong>Cluster</strong></p><p>Cluster æ˜¯è®¡ç®—ã€å­˜å‚¨å’Œç½‘ç»œèµ„æºçš„é›†åˆï¼ŒKubernetesåˆ©ç”¨è¿™äº›èµ„æºè¿è¡Œå„ç§åŸºäºå®¹å™¨çš„åº”ç”¨ã€‚</p><p><strong>Master</strong></p><p>Master æ˜¯ Cluster çš„å¤§è„‘ï¼Œå®ƒçš„ä¸»è¦èŒè´£æ˜¯è°ƒåº¦ï¼Œå³å†³å®šå°†åº”ç”¨æ”¾åœ¨å“ªé‡Œè¿è¡Œã€‚Master è¿è¡Œ Linux æ“ä½œç³»ç»Ÿï¼Œå¯ä»¥æ˜¯ç‰©ç†æœºæˆ–è€…è™šæ‹Ÿæœºã€‚ä¸ºäº†å®ç°é«˜å¯ç”¨ï¼Œå¯ä»¥è¿è¡Œå¤šä¸ª Masterã€‚</p><p><strong>Node</strong></p><p>Node çš„èŒè´£æ˜¯è¿è¡Œå®¹å™¨åº”ç”¨ã€‚Node ç”± Master ç®¡ç†ï¼ŒNode è´Ÿè´£ç›‘æ§å¹¶æ±‡æŠ¥å®¹å™¨çš„çŠ¶æ€ï¼Œå¹¶æ ¹æ® Master çš„è¦æ±‚ç®¡ç†å®¹å™¨çš„ç”Ÿå‘½å‘¨æœŸã€‚Node è¿è¡Œåœ¨ Linux æ“ä½œç³»ç»Ÿï¼Œå¯ä»¥æ˜¯ç‰©ç†æœºæˆ–è€…æ˜¯è™šæ‹Ÿæœºã€‚</p><p><strong>Pod</strong></p><p>Pod æ˜¯ Kubernetes çš„æœ€å°å·¥ä½œå•å…ƒã€‚æ¯ä¸ª Pod åŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªå®¹å™¨ã€‚Pod ä¸­çš„å®¹å™¨ä¼šä½œä¸ºä¸€ä¸ªæ•´ä½“è¢« Master è°ƒåº¦åˆ°ä¸€ä¸ª Node ä¸Šè¿è¡Œã€‚</p><p>Kubernetes å¼•å…¥ Pod ä¸»è¦åŸºäºä¸‹é¢ä¸¤ä¸ªç›®çš„ï¼š</p><ol><li>å¯ç®¡ç†æ€§</li></ol><p>æœ‰äº›å®¹å™¨å¤©ç”Ÿå°±æ˜¯éœ€è¦ç´§å¯†è”ç³»ï¼Œä¸€èµ·å·¥ä½œã€‚Pod æä¾›äº†æ¯”å®¹å™¨æ›´é«˜å±‚æ¬¡çš„æŠ½è±¡ï¼Œå°†å®ƒä»¬å°è£…åˆ°ä¸€ä¸ªéƒ¨ç½²å•å…ƒä¸­ã€‚Kubernetes ä»¥ Pod ä¸ºæœ€å°å•ä½è¿›è¡Œè°ƒåº¦ã€æ‰©å±•ã€å…±äº«èµ„æºã€ç®¡ç†ç”Ÿå‘½å‘¨æœŸã€‚</p><ol start=2><li>é€šä¿¡å’Œèµ„æºå…±äº«ã€‚</li></ol><p>Pod ä¸­çš„æ‰€æœ‰å®¹å™¨ä½¿ç”¨åŒä¸€ä¸ªç½‘ç»œ namespaceï¼Œå³ç›¸åŒçš„ IP åœ°å€å’Œ Port ç©ºé—´ã€‚å®ƒä»¬å¯ä»¥ç›´æ¥ç”¨ localhost é€šä¿¡ã€‚åŒæ ·çš„ï¼Œè¿™äº›å®¹å™¨å¯ä»¥å…±äº«å­˜å‚¨ï¼Œå½“ Kubernetes æŒ‚è½½ volume åˆ° Podï¼Œæœ¬è´¨ä¸Šæ˜¯å°† volume æŒ‚è½½åˆ° Pod ä¸­çš„æ¯ä¸€ä¸ªå®¹å™¨ã€‚</p><p>Pods æœ‰ä¸¤ç§ä½¿ç”¨æ–¹å¼ï¼š</p><ol><li>è¿è¡Œå•ä¸€å®¹å™¨ã€‚
one-container-per-Pod æ˜¯ Kubernetes æœ€å¸¸è§çš„æ¨¡å‹ï¼Œè¿™ç§æƒ…å†µä¸‹ï¼Œåªæ˜¯å°†å•ä¸ªå®¹å™¨ç®€å•å°è£…æˆ Podã€‚å³ä¾¿æ˜¯åªæœ‰ä¸€ä¸ªå®¹å™¨ï¼ŒKubernetes ç®¡ç†çš„ä¹Ÿæ˜¯ Pod è€Œä¸æ˜¯ç›´æ¥ç®¡ç†å®¹å™¨ã€‚</li><li>è¿è¡Œå¤šä¸ªå®¹å™¨ã€‚
ä½†é—®é¢˜åœ¨äºï¼šå“ªäº›å®¹å™¨åº”è¯¥æ”¾åˆ°ä¸€ä¸ª Pod ä¸­ï¼Ÿ
ç­”æ¡ˆæ˜¯ï¼šè¿™äº›å®¹å™¨è”ç³»å¿…é¡» éå¸¸ç´§å¯†ï¼Œè€Œä¸”éœ€è¦ ç›´æ¥å…±äº«èµ„æºã€‚</li></ol><p><strong>Controller</strong></p><p>Kubernetes é€šå¸¸ä¸ä¼šç›´æ¥åˆ›å»º Podï¼Œè€Œæ˜¯é€šè¿‡ Controller æ¥ç®¡ç† Pod çš„ã€‚Controller ä¸­å®šä¹‰äº† Pod çš„éƒ¨ç½²ç‰¹æ€§ï¼Œæ¯”å¦‚æœ‰å‡ ä¸ªå‰¯æœ¬ï¼Œåœ¨ä»€ä¹ˆæ ·çš„ Node ä¸Šè¿è¡Œç­‰ã€‚ä¸ºäº†æ»¡è¶³ä¸åŒçš„ä¸šåŠ¡åœºæ™¯ï¼ŒKubernetes æä¾›äº†å¤šç§ Controllerï¼ŒåŒ…æ‹¬ Deploymentã€ReplicaSetã€DaemonSetã€StatefuleSetã€Job ç­‰ã€‚</p><ol><li>Deployment</li></ol><p>æ˜¯æœ€å¸¸ç”¨çš„ Controllerï¼ŒDeployment å¯ä»¥ç®¡ç† Pod çš„å¤šä¸ªå‰¯æœ¬ï¼Œå¹¶ç¡®ä¿ Pod æŒ‰ç…§æœŸæœ›çš„çŠ¶æ€è¿è¡Œã€‚</p><ol start=2><li>ReplicaSet</li></ol><p>å®ç°äº† Pod çš„å¤šå‰¯æœ¬ç®¡ç†ã€‚ä½¿ç”¨ Deployment æ—¶ä¼šè‡ªåŠ¨åˆ›å»º ReplicaSetï¼Œä¹Ÿå°±æ˜¯è¯´ Deployment æ˜¯é€šè¿‡ ReplicaSet æ¥ç®¡ç† Pod çš„å¤šä¸ªå‰¯æœ¬ï¼Œæˆ‘ä»¬é€šå¸¸ä¸éœ€è¦ç›´æ¥ä½¿ç”¨ ReplicaSetã€‚</p><ol start=3><li>DaemonSet</li></ol><p>ç”¨äºæ¯ä¸ª Node æœ€å¤šåªè¿è¡Œä¸€ä¸ª Pod å‰¯æœ¬çš„åœºæ™¯ã€‚æ­£å¦‚å…¶åç§°æ‰€æ­ç¤ºçš„ï¼ŒDaemonSet é€šå¸¸ç”¨äºè¿è¡Œ daemonã€‚</p><ol start=4><li>StatefuleSet</li></ol><p>èƒ½å¤Ÿä¿è¯ Pod çš„æ¯ä¸ªå‰¯æœ¬åœ¨æ•´ä¸ªç”Ÿå‘½å‘¨æœŸä¸­åç§°æ˜¯ä¸å˜çš„ã€‚è€Œå…¶ä»– Controller ä¸æä¾›è¿™ä¸ªåŠŸèƒ½ï¼Œå½“æŸä¸ª Pod å‘ç”Ÿæ•…éšœéœ€è¦åˆ é™¤å¹¶é‡æ–°å¯åŠ¨æ—¶ï¼ŒPod çš„åç§°ä¼šå‘ç”Ÿå˜åŒ–ã€‚åŒæ—¶ StatefuleSet ä¼šä¿è¯å‰¯æœ¬æŒ‰ç…§å›ºå®šçš„é¡ºåºå¯åŠ¨ã€æ›´æ–°æˆ–è€…åˆ é™¤ã€‚</p><ol start=5><li>Job</li></ol><p>ç”¨äºè¿è¡Œç»“æŸå°±åˆ é™¤çš„åº”ç”¨ã€‚è€Œå…¶ä»– Controller ä¸­çš„ Pod é€šå¸¸æ˜¯é•¿æœŸæŒç»­è¿è¡Œã€‚</p><p><strong>Service</strong></p><p>Kubernetes Service å®šä¹‰äº†å¤–ç•Œè®¿é—®ä¸€ç»„ç‰¹å®š Pod çš„æ–¹å¼ã€‚Service æœ‰è‡ªå·±çš„ IP å’Œç«¯å£ï¼ŒService ä¸º Pod æä¾›äº†è´Ÿè½½å‡è¡¡ã€‚</p><p>Kubernetes è¿è¡Œå®¹å™¨ï¼ˆPodï¼‰ä¸è®¿é—®å®¹å™¨ï¼ˆPodï¼‰è¿™ä¸¤é¡¹ä»»åŠ¡åˆ†åˆ«ç”± Controller å’Œ Service æ‰§è¡Œã€‚</p><p><strong>Namespace</strong></p><p>Namespace å¯ä»¥å°†ä¸€ä¸ªç‰©ç†çš„ Cluster é€»è¾‘ä¸Šåˆ’åˆ†æˆå¤šä¸ªè™šæ‹Ÿ Clusterï¼Œæ¯ä¸ª Cluster å°±æ˜¯ä¸€ä¸ª Namespaceã€‚ä¸åŒ Namespace é‡Œçš„èµ„æºæ˜¯å®Œå…¨éš”ç¦»çš„ã€‚</p><p>Kubernetes é»˜è®¤åˆ›å»ºäº†ä¸¤ä¸ª Namespaceã€‚</p><ul><li>default &ndash; åˆ›å»ºèµ„æºæ—¶å¦‚æœä¸æŒ‡å®šï¼Œå°†è¢«æ”¾åˆ°è¿™ä¸ª Namespace ä¸­ã€‚</li><li>kube-system &ndash; Kubernetes è‡ªå·±åˆ›å»ºçš„ç³»ç»Ÿèµ„æºå°†æ”¾åˆ°è¿™ä¸ª Namespace ä¸­ã€‚</li></ul><h3 id=ç½‘ç»œæ¨¡å‹>ç½‘ç»œæ¨¡å‹</h3><p>ä¸ºäº†ä¿è¯ç½‘ç»œæ–¹æ¡ˆçš„æ ‡å‡†åŒ–ã€æ‰©å±•æ€§å’Œçµæ´»æ€§ï¼ŒKubernetes é‡‡ç”¨äº† Container Networking Interfaceï¼ˆCNIï¼‰è§„èŒƒã€‚</p><p>CNI æ˜¯ç”± CoreOS æå‡ºçš„å®¹å™¨ç½‘ç»œè§„èŒƒï¼Œå®ƒä½¿ç”¨äº†æ’ä»¶ï¼ˆPluginï¼‰æ¨¡å‹åˆ›å»ºå®¹å™¨çš„ç½‘ç»œæ ˆã€‚</p><p>ç›®å‰å·²æœ‰å¤šç§æ”¯æŒ Kubernetes çš„ç½‘ç»œæ–¹æ¡ˆï¼Œæ¯”å¦‚ Flannelã€Calicoã€Canalã€Weave Net ç­‰ã€‚å› ä¸ºå®ƒä»¬éƒ½å®ç°äº† CNI è§„èŒƒï¼Œç”¨æˆ·æ— è®ºé€‰æ‹©å“ªç§æ–¹æ¡ˆï¼Œå¾—åˆ°çš„ç½‘ç»œæ¨¡å‹éƒ½ä¸€æ ·ï¼Œå³æ¯ä¸ª Pod éƒ½æœ‰ç‹¬ç«‹çš„ IPï¼Œå¯ä»¥ç›´æ¥é€šä¿¡ã€‚åŒºåˆ«åœ¨äºä¸åŒæ–¹æ¡ˆçš„åº•å±‚å®ç°ä¸åŒã€‚</p><h2 id=k8sæ¶æ„>k8sæ¶æ„</h2><p><strong>æ¶æ„å›¾ï¼š</strong></p><p><img src=https://image-hosts-1305019894.cos.accelerate.myqcloud.com/2021/08/04/cf0185e7a78b7.jpg loading=lazy alt=image></p><h3 id=master>master</h3><blockquote><p>Master æ˜¯ Kubernetes Cluster çš„å¤§è„‘ï¼Œè¿è¡Œç€å¦‚ä¸‹ Daemon æœåŠ¡ï¼škube-apiserverã€kube-schedulerã€kube-controller-managerã€etcd å’Œ Pod ç½‘ç»œï¼ˆä¾‹å¦‚ flannelï¼‰ã€‚</p></blockquote><p><strong>API Serverï¼ˆkube-apiserverï¼‰</strong></p><p>API Server æä¾› HTTP/HTTPS RESTful APIï¼Œå³ Kubernetes APIã€‚API Server æ˜¯ Kubernetes Cluster çš„å‰ç«¯æ¥å£ï¼Œå„ç§å®¢æˆ·ç«¯å·¥å…·ï¼ˆCLI æˆ– UIï¼‰ä»¥åŠ Kubernetes å…¶ä»–ç»„ä»¶å¯ä»¥é€šè¿‡å®ƒç®¡ç† Cluster çš„å„ç§èµ„æºã€‚</p><p><strong>Schedulerï¼ˆkube-schedulerï¼‰</strong></p><p>Scheduler è´Ÿè´£å†³å®šå°† Pod æ”¾åœ¨å“ªä¸ª Node ä¸Šè¿è¡Œã€‚Scheduler åœ¨è°ƒåº¦æ—¶ä¼šå……åˆ†è€ƒè™‘ Cluster çš„æ‹“æ‰‘ç»“æ„ï¼Œå½“å‰å„ä¸ªèŠ‚ç‚¹çš„è´Ÿè½½ï¼Œä»¥åŠåº”ç”¨å¯¹é«˜å¯ç”¨ã€æ€§èƒ½ã€æ•°æ®äº²å’Œæ€§çš„éœ€æ±‚ã€‚</p><p><strong>Controller Managerï¼ˆkube-controller-managerï¼‰</strong></p><p>Controller Manager è´Ÿè´£ç®¡ç† Cluster å„ç§èµ„æºï¼Œä¿è¯èµ„æºå¤„äºé¢„æœŸçš„çŠ¶æ€ã€‚Controller Manager ç”±å¤šç§ controller ç»„æˆï¼ŒåŒ…æ‹¬ replication controllerã€endpoints controllerã€namespace controllerã€serviceaccounts controller ç­‰ã€‚</p><p>ä¸åŒçš„ controller ç®¡ç†ä¸åŒçš„èµ„æºã€‚ä¾‹å¦‚ replication controller ç®¡ç† Deploymentã€StatefulSetã€DaemonSet çš„ç”Ÿå‘½å‘¨æœŸï¼Œnamespace controller ç®¡ç† Namespace èµ„æºã€‚</p><p><strong>etcd</strong></p><p>etcd è´Ÿè´£ä¿å­˜ Kubernetes Cluster çš„é…ç½®ä¿¡æ¯å’Œå„ç§èµ„æºçš„çŠ¶æ€ä¿¡æ¯ã€‚å½“æ•°æ®å‘ç”Ÿå˜åŒ–æ—¶ï¼Œetcd ä¼šå¿«é€Ÿåœ°é€šçŸ¥ Kubernetes ç›¸å…³ç»„ä»¶ã€‚</p><p><strong>Pod ç½‘ç»œ</strong></p><p>Pod è¦èƒ½å¤Ÿç›¸äº’é€šä¿¡ï¼ŒKubernetes Cluster å¿…é¡»éƒ¨ç½² Pod ç½‘ç»œï¼Œflannel æ˜¯å…¶ä¸­ä¸€ä¸ªå¯é€‰æ–¹æ¡ˆã€‚</p><h3 id=node>node</h3><blockquote><p>Node æ˜¯ Pod è¿è¡Œçš„åœ°æ–¹ï¼ŒKubernetes æ”¯æŒ Dockerã€rkt ç­‰å®¹å™¨ Runtimeã€‚ Nodeä¸Šè¿è¡Œçš„ Kubernetes ç»„ä»¶æœ‰ kubeletã€kube-proxy å’Œ Pod ç½‘ç»œï¼ˆä¾‹å¦‚ flannelï¼‰ã€‚</p></blockquote><p><strong>kubelet</strong></p><p>kubelet æ˜¯ Node çš„ agentï¼Œå½“ Scheduler ç¡®å®šåœ¨æŸä¸ª Node ä¸Šè¿è¡Œ Pod åï¼Œä¼šå°† Pod çš„å…·ä½“é…ç½®ä¿¡æ¯ï¼ˆimageã€volume ç­‰ï¼‰å‘é€ç»™è¯¥èŠ‚ç‚¹çš„ kubeletï¼Œkubelet æ ¹æ®è¿™äº›ä¿¡æ¯åˆ›å»ºå’Œè¿è¡Œå®¹å™¨ï¼Œå¹¶å‘ Master æŠ¥å‘Šè¿è¡ŒçŠ¶æ€ã€‚</p><p><strong>kube-proxy</strong></p><p>service åœ¨é€»è¾‘ä¸Šä»£è¡¨äº†åç«¯çš„å¤šä¸ª Podï¼Œå¤–ç•Œé€šè¿‡ service è®¿é—® Podã€‚service æ¥æ”¶åˆ°çš„è¯·æ±‚æ˜¯å¦‚ä½•è½¬å‘åˆ° Pod çš„å‘¢ï¼Ÿè¿™å°±æ˜¯ kube-proxy è¦å®Œæˆçš„å·¥ä½œã€‚</p><p>æ¯ä¸ª Node éƒ½ä¼šè¿è¡Œ kube-proxy æœåŠ¡ï¼Œå®ƒè´Ÿè´£å°†è®¿é—® service çš„ TCP/UPD æ•°æ®æµè½¬å‘åˆ°åç«¯çš„å®¹å™¨ã€‚å¦‚æœæœ‰å¤šä¸ªå‰¯æœ¬ï¼Œkube-proxy ä¼šå®ç°è´Ÿè½½å‡è¡¡ã€‚</p><p><strong>Pod ç½‘ç»œ</strong></p><p>Pod è¦èƒ½å¤Ÿç›¸äº’é€šä¿¡ï¼ŒKubernetes Cluster å¿…é¡»éƒ¨ç½² Pod ç½‘ç»œï¼Œflannel æ˜¯å…¶ä¸­ä¸€ä¸ªå¯é€‰æ–¹æ¡ˆã€‚</p><h2 id=å®‰è£…>å®‰è£…</h2><h3 id=å…³é—­swap>å…³é—­swap</h3><p>ä¸´æ—¶å…³é—­</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>sudo swapoff -a
</span></span></code></pre></td></tr></table></div></div><p>æ°¸ä¹…å…³é—­</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>sudo vim /etc/fstab
</span></span><span class=line><span class=cl><span class=c1>## æ³¨é‡Š</span>
</span></span><span class=line><span class=cl><span class=c1>#/swap.img      none    swap    sw      0       0</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=å®‰è£…kubeadm-kubeadm-kubectlå›½å†…æº>å®‰è£…kubeadm kubeadm kubectlï¼ˆå›½å†…æºï¼‰</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>sudo apt-get update <span class=o>&amp;&amp;</span> sudo apt-get install -y ca-certificates curl 
</span></span><span class=line><span class=cl>curl -s https://mirrors.aliyun.com/kubernetes/apt/doc/apt-key.gpg <span class=p>|</span> sudo apt-key add -
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;deb https://mirrors.aliyun.com/kubernetes/apt/ kubernetes-xenial main&#34;</span> &gt; /etc/apt/sources.list.d/kubernetes.list
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>sudo apt-get update <span class=o>&amp;&amp;</span> apt-get install -y kubelet kubeadm kubectl
</span></span><span class=line><span class=cl>sudo apt-mark hold kubelet kubeadm kubectl
</span></span></code></pre></td></tr></table></div></div><h3 id=ä¸‹è½½k8sé•œåƒå›½å†…æº>ä¸‹è½½k8sé•œåƒï¼ˆå›½å†…æºï¼‰</h3><p>ä½¿ç”¨è„šæœ¬ä¸€é”®ä¸‹è½½å¹¶æ›´å</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=cp>#!/usr/bin/env bash
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl>docker image pull <span class=s2>&#34;registry.cn-hangzhou.aliyuncs.com/google_containers/coredns:1.8.0&#34;</span>
</span></span><span class=line><span class=cl>docker image tag <span class=s2>&#34;registry.cn-hangzhou.aliyuncs.com/google_containers/coredns:1.8.0&#34;</span>
</span></span><span class=line><span class=cl>docker image rmi <span class=s2>&#34;registry.cn-hangzhou.aliyuncs.com/google_containers/coredns:1.8.0&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>for</span> IT in etcd:3.4.13-0 pause:3.4.1 kube-proxy:v1.21.3 kube-scheduler:v1.21.3 kube-controller-manager:v1.21.3 kube-apiserver:v1.21.3
</span></span><span class=line><span class=cl><span class=k>do</span>
</span></span><span class=line><span class=cl>    docker image pull <span class=s2>&#34;registry.cn-hangzhou.aliyuncs.com/google_containers/</span><span class=nv>$IT</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>    docker image tag  <span class=s2>&#34;registry.cn-hangzhou.aliyuncs.com/google_containers/</span><span class=nv>$IT</span><span class=s2>&#34;</span> <span class=s2>&#34;k8s.gcr.io/</span><span class=nv>$IT</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>    docker image rmi  <span class=s2>&#34;registry.cn-hangzhou.aliyuncs.com/google_containers/</span><span class=nv>$IT</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl><span class=k>done</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=éƒ¨ç½²>éƒ¨ç½²</h2><h3 id=åˆå§‹åŒ–master>åˆå§‹åŒ–Master</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>kubeadm init --apiserver-advertise-address <span class=o>[</span>k8s-master ip<span class=o>]</span> --pod-network-cidr<span class=o>=</span>10.244.0.0/16
</span></span></code></pre></td></tr></table></div></div><p><strong>è¿‡ç¨‹ï¼š</strong></p><ol><li>kubeadm æ‰§è¡Œåˆå§‹åŒ–å‰çš„æ£€æŸ¥ã€‚</li><li>ç”Ÿæˆ token å’Œè¯ä¹¦ã€‚</li><li>ç”Ÿæˆ KubeConfig æ–‡ä»¶ï¼Œkubelet éœ€è¦è¿™ä¸ªæ–‡ä»¶ä¸ Master é€šä¿¡ã€‚</li><li>å®‰è£… Master ç»„ä»¶ï¼Œä¼šä» goolge çš„ Registry ä¸‹è½½ç»„ä»¶çš„ Docker é•œåƒï¼Œè¿™ä¸€æ­¥å¯èƒ½ä¼šèŠ±ä¸€äº›æ—¶é—´ï¼Œä¸»è¦å–å†³äºç½‘ç»œè´¨é‡ã€‚</li><li>å®‰è£…é™„åŠ ç»„ä»¶ kube-proxy å’Œ kube-dnsã€‚</li><li>Kubernetes Master åˆå§‹åŒ–æˆåŠŸã€‚</li><li>æç¤ºå¦‚ä½•é…ç½® kubectlã€‚</li><li>æç¤ºå¦‚ä½•å®‰è£… Pod ç½‘ç»œã€‚</li><li>æç¤ºå¦‚ä½•æ³¨å†Œå…¶ä»–èŠ‚ç‚¹åˆ° Clusterã€‚</li></ol><h3 id=é…ç½®kubectl>é…ç½®kubectl</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>mkdir -p <span class=nv>$HOME</span>/.kubesudo 
</span></span><span class=line><span class=cl>cp -i /etc/kubernetes/admin.conf <span class=nv>$HOME</span>/.kube/configsudo 
</span></span><span class=line><span class=cl>chown <span class=k>$(</span>id -u<span class=k>)</span>:<span class=k>$(</span>id -g<span class=k>)</span> <span class=nv>$HOME</span>/.kube/config
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># å‘½ä»¤è¡¥å…¨</span>
</span></span><span class=line><span class=cl>apt-get -y install bash-completion
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;source &lt;(kubectl completion bash)&#34;</span> &gt;&gt; ~/.bashrc
</span></span></code></pre></td></tr></table></div></div><h4 id=kubectlå¸¸ç”¨å‘½ä»¤>kubectlå¸¸ç”¨å‘½ä»¤</h4><p><strong>logsï¼šæŸ¥çœ‹PODæˆ–å®¹å™¨çš„æ—¥å¿—</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=c1>#æŸ¥çœ‹PODä¸­æ‰€æœ‰å®¹å™¨çš„æ—¥å¿—</span>
</span></span><span class=line><span class=cl>kubectl logs nginxpod
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#æŸ¥çœ‹PODä¸­æŒ‡å®šå®¹å™¨çš„æ—¥å¿—</span>
</span></span><span class=line><span class=cl>kubectl logs nginxpod -c nginx
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#æŸ¥çœ‹æŒ‡å®šåç§°ç©ºé—´ä¸­çš„PODä¸­çš„æŒ‡å®šå®¹å™¨æ—¥å¿—</span>
</span></span><span class=line><span class=cl>kubectl logs -n <span class=nb>test</span> mysqlpod -c mysql
</span></span></code></pre></td></tr></table></div></div><p><strong>describeï¼šæ˜¾ç¤ºèµ„æºè¿è¡ŒçŠ¶æ€ä¿¡æ¯</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>kubectl describe pod &lt;Pod Name&gt;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#æŸ¥çœ‹æŒ‡å®šåç§°ç©ºé—´çš„POD</span>
</span></span><span class=line><span class=cl>kubectl describe pods nginxpod
</span></span><span class=line><span class=cl>kubectl describe pods mysql -n <span class=nb>test</span>
</span></span><span class=line><span class=cl>kubectl describe pod kube-flannel-ds-v0p3x --namespace<span class=o>=</span>kube-system
</span></span></code></pre></td></tr></table></div></div><p><strong>execï¼šåœ¨PODä¸­æ‰§è¡Œå‘½ä»¤</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=c1>#æ­¤æ–¹å¼åªé€‚ç”¨äºPODåªæœ‰ä¸€ä¸ªå®¹å™¨æ—¶</span>
</span></span><span class=line><span class=cl>kubectl <span class=nb>exec</span> -it nginxpod -- /bin/bash
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#å¦‚PODä¸­æœ‰å¤šä¸ªå®¹å™¨éœ€è¦ä½¿ç”¨-cé€‰é¡¹æŒ‡å®šå®¹å™¨</span>
</span></span><span class=line><span class=cl>kubectl <span class=nb>exec</span> -it nginxpod -c nginx -- /bin/bash
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#ä¸€æ¬¡æ€§æ‰§è¡Œå¤šä¸ªå‘½ä»¤æˆ–ä½¿ç”¨ç®¡é“ç¬¦</span>
</span></span><span class=line><span class=cl>kubectl <span class=nb>exec</span> nfs -- sh -c <span class=s2>&#34;echo &#39;SET testkey www.linux321.com&#39; | redis-cli&#34;</span>
</span></span><span class=line><span class=cl>kubectl <span class=nb>exec</span> nfs -- sh -c <span class=s2>&#34;echo &#39;GET testkey&#39; | redis-cli&#34;</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>æŸ¥çœ‹èµ„æºç±»å‹</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>kubectl api-resouurce
</span></span></code></pre></td></tr></table></div></div><p><strong>æŸ¥çœ‹åç§°ç©ºé—´</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>kubectl get namespaces
</span></span></code></pre></td></tr></table></div></div><p><strong>æŸ¥çœ‹èŠ‚ç‚¹çŠ¶æ€</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=c1>#åœ¨masterä¸Šæ‰§è¡Œ</span>
</span></span><span class=line><span class=cl> kubectl get nodes
</span></span></code></pre></td></tr></table></div></div><p><strong>æŸ¥çœ‹podçŠ¶æ€</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>kubectl get pod --all-namespaces
</span></span><span class=line><span class=cl>kubectl get po -A
</span></span></code></pre></td></tr></table></div></div><h3 id=éƒ¨ç½²flannel>éƒ¨ç½²flannel</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>kubectl apply -f https://raw.githubusercontent.com/coreos/flannel/master/Documentation/kube-flannel.yml
</span></span></code></pre></td></tr></table></div></div><p>å›½å†…é•œåƒä»“åº“æ‰‹åŠ¨ä¸‹è½½flannel</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>docker pull registry.cn-hangzhou.aliyuncs.com/k8sos/flannel:v0.14.0
</span></span></code></pre></td></tr></table></div></div><h3 id=å­èŠ‚ç‚¹åŠ å…¥master>å­èŠ‚ç‚¹åŠ å…¥Master</h3><p><strong>æŸ¥çœ‹ç°æœ‰token</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>kubeadm token list
</span></span></code></pre></td></tr></table></div></div><p><strong>ç”Ÿæˆä¸€ä¸ªæ–°token</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>kubeadm token create --print-join-command
</span></span><span class=line><span class=cl><span class=c1># é»˜è®¤æœ‰æ•ˆæœŸ24å°æ—¶,è‹¥æƒ³ä¹…ä¸€äº›å¯ä»¥ç»“åˆ--ttlå‚æ•°,è®¾ä¸º0åˆ™ç”¨ä¸è¿‡æœŸ</span>
</span></span><span class=line><span class=cl>kubeadm token create --ttl <span class=m>0</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>æŸ¥çœ‹caè¯ä¹¦çš„hash</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>openssl x509 -pubkey -in /etc/kubernetes/pki/ca.crt <span class=p>|</span> openssl rsa -pubin -outform der 2&gt;/dev/null <span class=p>|</span> openssl dgst -sha256 -hex <span class=p>|</span> sed <span class=s1>&#39;s/^.* //&#39;</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>nodeåŠ å…¥Master</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>kubeadm join <span class=o>[</span>k8s-master ip<span class=o>]</span>:6443 --token <span class=o>[</span>token<span class=o>]</span> --discovery-token-ca-cert-hash <span class=o>[</span>ca cert<span class=o>]</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>å­èŠ‚ç‚¹éœ€è¦çš„é•œåƒ</strong></p><ul><li>flannel</li><li>pause</li><li>k8s-proxy</li></ul><p><strong>æŸ¥çœ‹èŠ‚ç‚¹çŠ¶æ€</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=c1>#åœ¨masterä¸Šæ‰§è¡Œ</span>
</span></span><span class=line><span class=cl>kubectl get nodes
</span></span><span class=line><span class=cl><span class=c1>#éƒ½å¤„äºreadyçŠ¶æ€ï¼Œè¯´æ˜nodeèŠ‚ç‚¹å·²å¯ç”¨</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>æŸ¥çœ‹podçŠ¶æ€</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>kubectl get pod --all-namespaces
</span></span><span class=line><span class=cl>kubectl get po -A
</span></span></code></pre></td></tr></table></div></div><p><strong>æŸ¥çœ‹podè¿è¡Œæƒ…å†µ</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>kubectl describe pod kube-flannel-ds-v0p3x --namespace<span class=o>=</span>kube-system
</span></span><span class=line><span class=cl><span class=c1>#å¦‚æœé•œåƒå·²ç»éƒ½ä¸‹è½½å¥½è¿˜æ²¡å¤„äºreadyçŠ¶æ€ï¼Œå¯å°è¯•é‡å¯å®¹å™¨æœåŠ¡systemctl restart docker</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=åˆ é™¤èŠ‚ç‚¹>åˆ é™¤èŠ‚ç‚¹</h3><p>åº”é¦–å…ˆæ¸…ç©ºèŠ‚ç‚¹å¹¶ç¡®ä¿è¯¥èŠ‚ç‚¹ä¸ºç©ºï¼Œ ç„¶åå–æ¶ˆé…ç½®è¯¥èŠ‚ç‚¹ã€‚</p><p>ä½¿ç”¨é€‚å½“çš„å‡­è¯ä¸æ§åˆ¶å¹³é¢èŠ‚ç‚¹é€šä¿¡ï¼Œè¿è¡Œï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>kubectl drain &lt;node name&gt; --delete-local-data --force --ignore-daemonsets
</span></span></code></pre></td></tr></table></div></div><p>åœ¨åˆ é™¤èŠ‚ç‚¹ä¹‹å‰ï¼Œè¯·é‡ç½® kubeadm å®‰è£…çš„çŠ¶æ€ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>kubeadm reset
</span></span></code></pre></td></tr></table></div></div><p>é‡ç½®è¿‡ç¨‹ä¸ä¼šé‡ç½®æˆ–æ¸…é™¤ iptables è§„åˆ™æˆ– IPVS è¡¨ã€‚å¦‚æœä½ å¸Œæœ›é‡ç½® iptablesï¼Œåˆ™å¿…é¡»æ‰‹åŠ¨è¿›è¡Œï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>iptables -F <span class=o>&amp;&amp;</span> iptables -t nat -F <span class=o>&amp;&amp;</span> iptables -t mangle -F <span class=o>&amp;&amp;</span> iptables -X
</span></span></code></pre></td></tr></table></div></div><p>å¦‚æœè¦é‡ç½® IPVS è¡¨ï¼Œåˆ™å¿…é¡»è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>ipvsadm -C
</span></span></code></pre></td></tr></table></div></div><p>ç°åœ¨åˆ é™¤èŠ‚ç‚¹ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>kubectl delete node &lt;node name&gt;
</span></span></code></pre></td></tr></table></div></div><h2 id=è¿è¡Œåº”ç”¨>è¿è¡Œåº”ç”¨</h2><h3 id=å‘½ä»¤è¿è¡Œ>å‘½ä»¤è¿è¡Œ</h3><p><strong>åˆ›å»ºåº”ç”¨</strong></p><p>masterå…ˆä¸‹è½½nginxé•œåƒ</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>kubectl create deployment NAME --image<span class=o>=</span>image -- <span class=o>[</span>COMMAND<span class=o>]</span> <span class=o>[</span>args...<span class=o>]</span> <span class=o>[</span>options<span class=o>]</span>
</span></span><span class=line><span class=cl>kubectl create deployment nginx --image<span class=o>=</span><span class=s2>&#34;nginx:1.18.0&#34;</span>
</span></span><span class=line><span class=cl><span class=c1>#æˆ–è€…</span>
</span></span><span class=line><span class=cl>kubectl run deployment nginx --image<span class=o>=</span><span class=s2>&#34;nginx:1.21.1&#34;</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>åˆ é™¤åº”ç”¨</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>kubectl delete deployment/nginx
</span></span></code></pre></td></tr></table></div></div><p><strong>æŸ¥çœ‹pod</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>kubectl get pods
</span></span><span class=line><span class=cl><span class=c1>#æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯</span>
</span></span><span class=line><span class=cl>kubectl describe pod
</span></span></code></pre></td></tr></table></div></div><p><strong>åˆ é™¤pod</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>kubectl delete pods
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#åˆ é™¤æ‰€æœ‰POD</span>
</span></span><span class=line><span class=cl>kubectl delete pods --all
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#åˆ é™¤æŒ‡å®šå¤šä¸ªPOD</span>
</span></span><span class=line><span class=cl>kubectl delete pods nginxpod demoapp
</span></span></code></pre></td></tr></table></div></div><p><strong>æŸ¥çœ‹å®¹å™¨è°ƒåº¦</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>kubectl get pods -o wide
</span></span></code></pre></td></tr></table></div></div><p><strong>æ‹“å±•å®ä¾‹</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>kubectl scale deployment nginx --replicas<span class=o>=</span><span class=m>3</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>æŸ¥çœ‹ReplicaSet</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>kubectl get replicaset
</span></span></code></pre></td></tr></table></div></div><h3 id=é…ç½®è¿è¡Œ>é…ç½®è¿è¡Œ</h3><p><strong>åˆ›å»ºDeploymentçš„ymlæ–‡ä»¶</strong></p><p>å¸¸ç”¨å­—æ®µï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>apiVersion: apps/v1    <span class=c1># APIç¾¤ç»„åŠç‰ˆæœ¬</span>
</span></span><span class=line><span class=cl>kind: Deployment       <span class=c1># èµ„æºç±»å‹ç‰¹æœ‰æ ‡è¯†</span>
</span></span><span class=line><span class=cl>metadata:
</span></span><span class=line><span class=cl>  name &lt;string&gt;        <span class=c1># èµ„æºåç§°ï¼Œåœ¨ä½œç”¨åŸŸä¸­è¦å”¯ä¸€</span>
</span></span><span class=line><span class=cl>  namespace &lt;string&gt;   <span class=c1># åç§°ç©ºé—´ï¼›Deploymentéš¶å±åç§°ç©ºé—´çº§åˆ«</span>
</span></span><span class=line><span class=cl>spec:
</span></span><span class=line><span class=cl>  minReadySeconds &lt;integer&gt;  <span class=c1># Podå°±ç»ªåå¤šå°‘ç§’å†…ä»»ä¸€å®¹å™¨æ— crashæ–¹å¯è§†ä¸ºâ€œå°±ç»ªâ€</span>
</span></span><span class=line><span class=cl>  replicas &lt;integer&gt;         <span class=c1># æœŸæœ›çš„Podå‰¯æœ¬æ•°ï¼Œé»˜è®¤ä¸º1</span>
</span></span><span class=line><span class=cl>  selector &lt;object&gt;          <span class=c1># æ ‡ç­¾é€‰æ‹©å™¨ï¼Œå¿…é¡»åŒ¹é…templateå­—æ®µä¸­Podæ¨¡æ¿ä¸­çš„æ ‡ç­¾</span>
</span></span><span class=line><span class=cl>  template &lt;object&gt;          <span class=c1># Podæ¨¡æ¿å¯¹è±¡</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  revisionHistoryLimit &lt;integer&gt; <span class=c1># æ»šåŠ¨æ›´æ–°å†å²è®°å½•æ•°é‡ï¼Œé»˜è®¤ä¸º10</span>
</span></span><span class=line><span class=cl>  strategy &lt;Object&gt;              <span class=c1># æ»šåŠ¨æ›´æ–°ç­–ç•¥</span>
</span></span><span class=line><span class=cl>    <span class=nb>type</span> &lt;string&gt;                <span class=c1># æ»šåŠ¨æ›´æ–°ç±»å‹ï¼Œå¯ç”¨å€¼æœ‰Recreateå’ŒRollingUpdateï¼›</span>
</span></span><span class=line><span class=cl>    rollingUpdate &lt;Object&gt;       <span class=c1># æ»šåŠ¨æ›´æ–°å‚æ•°ï¼Œä¸“ç”¨äºRollingUpdateç±»å‹</span>
</span></span><span class=line><span class=cl>      maxSurge &lt;string&gt;          <span class=c1># æ›´æ–°æœŸé—´å¯æ¯”æœŸæœ›çš„Podæ•°é‡å¤šå‡ºçš„æ•°é‡æˆ–æ¯”ä¾‹ï¼›</span>
</span></span><span class=line><span class=cl>      maxUnavailable &lt;string&gt;    <span class=c1># æ›´æ–°æœŸé—´å¯æ¯”æœŸæœ›çš„Podæ•°é‡ç¼ºå°‘çš„æ•°é‡æˆ–æ¯”ä¾‹ï¼Œ10ï¼Œ </span>
</span></span><span class=line><span class=cl>  progressDeadlineSeconds &lt;integer&gt;  <span class=c1># æ»šåŠ¨æ›´æ–°æ•…éšœè¶…æ—¶æ—¶é•¿ï¼Œé»˜è®¤ä¸º600ç§’</span>
</span></span><span class=line><span class=cl>  paused &lt;boolean&gt;                   <span class=c1># æ˜¯å¦æš‚åœéƒ¨ç½²è¿‡ç¨‹</span>
</span></span></code></pre></td></tr></table></div></div><p>æ‰§è¡Œapplyå‘½ä»¤è¿è¡Œ</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>kubectl apply -f deployment.yml
</span></span></code></pre></td></tr></table></div></div></section><footer class=article-footer><section class=article-tags><a href=/tags/linux/>Linux</a></section><section class=article-copyright><svg class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg>
<span>Licensed under CC BY-NC-SA 4.0</span></section><section class=article-lastmod><svg class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<span>æœ€åæ›´æ–°äº Jan 01, 2023 00:00 UTC</span></section></footer></article><aside class=related-content--wrapper><h2 class=section-title>ç›¸å…³æ–‡ç« </h2><div class=related-content><div class="flex article-list--tile"><article><a href=/p/docker%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/><div class=article-details><h2 class=article-title>Dockerå­¦ä¹ ç¬”è®°</h2></div></a></article><article><a href=/p/c%E8%AF%AD%E8%A8%80%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95/><div class=article-details><h2 class=article-title>Cè¯­è¨€å•å…ƒæµ‹è¯•</h2></div></a></article><article><a href=/p/hexo%E6%90%AD%E5%BB%BA%E6%8C%87%E5%8D%97/><div class=article-details><h2 class=article-title>Hexoæ­å»ºæŒ‡å—</h2></div></a></article><article><a href=/p/hugo%E6%90%AD%E5%BB%BA%E6%8C%87%E5%8D%97/><div class=article-details><h2 class=article-title>Hugoæ­å»ºæŒ‡å—</h2></div></a></article></div></div></aside><div class=disqus-container><div id=disqus_thread></div><script>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//hugo-theme-stack.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div><style>.disqus-container{background-color:var(--card-background);border-radius:var(--card-border-radius);box-shadow:var(--shadow-l1);padding:var(--card-padding)}</style><script>window.addEventListener("onColorSchemeChange",e=>{typeof DISQUS=="object"&&DISQUS.reset({reload:!0})})</script><footer class=site-footer><section class=copyright>&copy;
2020 -
2024 æœˆèƒ§æ˜</section><section class=powerby>ä½¿ç”¨ <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a> æ„å»º<br>ä¸»é¢˜ <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.29.0>Stack</a></b> ç”± <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a> è®¾è®¡</section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.1e9a3bafd846ced4c345d084b355fb8c7bae75701c338f8a1f8a82c780137826.js defer></script><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>